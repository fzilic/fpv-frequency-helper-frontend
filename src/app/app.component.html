<div class="accordion">

  <div class="card">
    <div class="card-header">
      <span>
        <button class="btn btn-link" type="button" (click)="mainAccordion = 'bands'">
          {{'Bands ' + activeBandsString()}}
        </button>
      </span>
    </div>
    <div [class.collapse]="mainAccordion != 'bands'">
      <div class="card-body">
        <div *ngIf="bands" class="btn-group btn-group-toggle flex-wrap d-flex">
          <label *ngFor="let band of bands" class="btn-secondary w-50" ngbButtonLabel>
            <input type="checkbox" ngbButton [(ngModel)]="band.preselected"> {{ band.description || band.name }}
          </label>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <span class="pull-left">
        <button class="btn btn-link" type="button" (click)="mainAccordion = 'pilots'">
          {{'Pilots (' + pilots.length + ')'}}
        </button>
      </span>
      <span class="pull-right">
        <button class="btn btn-success" (click)="addPilot()">
        <fa name="plus"></fa>
      </button>
      </span>
    </div>
    <div [class.collapse]="mainAccordion != 'pilots'">

      <div class="container" *ngIf="pilots">
        <div *ngFor="let pilot of pilots; let i = index" class="card">
          <div class="card-header">
            <span>{{pilot.nickname}}</span>
            <span class="pull-right"><button class="btn btn-danger" (click)="removePilot(pilot)"><fa name="minus"></fa></button></span>
          </div>
          <form>
            <div class="form-group">
              <label [for]="'pilot.nickname' + i">Nickname</label>
              <input type="text" class="form-control"
                     [id]="'pilot.nickname' + i"
                     [name]="'pilot.nickname' + i"
                     [(ngModel)]="pilot.nickname">
            </div>

            <div class="form-group">
              <label [for]="'pilot.availableChannels' + i">Channels</label>

              <div class="accordion" *ngIf="activeBands()">

                <div class="card" *ngFor="let band of activeBands()">
                  <div class="card-header">
                    <span class="pull-left">
                      <button class="btn btn-link" type="button"
                              (click)="subAccordion =  (subAccordion != ('pilot.availableChannels.' + i + '.' + band.id) ? 'pilot.availableChannels.' + i + '.' + band.id : null )">
                        {{ ( band.description || band.name ) }}</button>
                    </span>
                  </div>
                  <div [class.collapse]="subAccordion != 'pilot.availableChannels.' + i + '.' + band.id">
                    <div *ngIf="band.channels" class="btn-group btn-group-toggle flex-wrap d-flex">
                      <label *ngFor="let channel of band.channels" class="btn-info w-50" ngbButtonLabel>
                        <input type="checkbox" ngbButton [value]="channel" (change)="onChannelSelectionChange(pilot, channel, $event)"> {{ channel.number + ' (' + channel.frequency + ')' }}
                      </label>
                    </div>
                  </div>
                </div>
              </div>

            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-header" id="panel-results">
      <span>
        <button class="btn btn-link" type="button" (click)="mainAccordion = 'results'">
          Results
        </button>
      </span>
    </div>
    <div id="collapseResults" [class.collapse]="mainAccordion != 'results'">
      TODO
    </div>
  </div>
</div>
